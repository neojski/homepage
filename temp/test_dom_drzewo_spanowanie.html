<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title></title>
        <script type="text/javascript">
        function f(el){
          for(var i=0,d; d=el.childNodes[i++];){
            if(d.childNodes.length==1&&d.firstChild.nodeName=='#text'){
              var s=document.createElement('span');
              s.onclick=function(){alert('a')}
              s.appendChild(document.createTextNode('test'));
              d.parentNode.replaceChild(s,d);
            }else if(d.nodeName!='#text'){
              f(d);
            }
          }
        }
        onload=function(){
          f(document.getElementById('d'))
        }
        </script>
    </head>
    <body>

        <div id="d">
          <strong>
            test
            <em>
              test
            </em>
          </strong>
        </div>

    </body>
</html>
